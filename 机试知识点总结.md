### 知识点

#### 1. 数据库连接设置

+ 哪些知识点还不是很清楚呢？

  ```sql
  -c mean command "SQL"
  -f file.sql
  \i file.sql 恢复
  ```

+ ```sql
  -- 默认是查看全局连接数
  show max_connections --一般不能set修改
  ```

+ ```sql
  -- 指定数据库连接数 pg_database 
  select * from pg_database limit 1;
  select datname,datconnlimit from pg_database where datname = 'dbname';
  ```

+ ```sql
  -- 指定查看最大连接数 系统视图 pg_roles pg_user
  ```
  
+ 

#### 2. 用户权限管理和使用

#### 3. 安全策略

##### 3.1 行级访问控制 

```sql
alter row level security policy rls on table to username using(id =2 or id =2);

grant select on tablename to username;

alter table tablename enable row level security;

create row level security policy tls_1 on tablename to username using(id=1);
```

```sql
-- create table t_test
create table t_test(id int,name varchar(20));

insert into t_test values(1,'name'),(2,'username');

create row level security policy rlspname on t_test to user3 using(id = 1)
for + 场景或者是条件 for all(select,update, delete)[不含insert,for 场景后面要么接all,或者是select,update delete中的其中一个场景，不能同时接多个场景]
-- create for 场景和table确定后 不可修改？

-- 2. 修改行级访问控制 
alter row level security policy rlsname on tabmenaem to username using(??????)

create table t_user(id varchar(10),age int);

insert into t_user values('u1',20),('u2',50);

alter table t_user enable row level security;

create row level security policy rls2 on t_user to u1,u2 for select using(id = current_user);

create row level security policy rls2 on t_user for select to u1,u2 using(id = current_user);

grant select on t_user to u1,u2;

\c - u1

select * from t_user;

\c - u2 

select * from t_user; -- 作用于哪个用户


su - omm
\c - omm


grant all on t_user to u2;

\c - u2

create row level security policy rls3 on t_user to u2 using(id = current_user and age >=30);

\c - omm
create row level security policy rls3 on t_user to u1 using(age >=30); --满足其中一个就行？

```



##### 3.2 审计策略

```sql

传统审计，改参数

pg_settings
show audit_enabled

统一审计
select * from pg_settings where name like '%policy%';

考试时，有配置管理页面

create resource label label_t1 add table(t_user);

create audit policy adt1 privileges/access

create audit policy adt1 privileges create,alter on label() filter on ip() app(),app(),roles()

gs_auditing select * from gs_auditing


```

##### 3.3 脱敏策略

```sql
-- 1. 脱敏也会受到audit策略影响，也要绑定资源标签

create resource label lab_name add column(public.tablename.colname);
## 绑定
create masking policy --> \h create masking 


第一种
create masking policy mask1 maskall label(label_name);
select * from gs_masking
select * from t_test

insert into t_tes values(4,'123-123-45678'),(5,'');
alter masking policy mask1 add/modiry creditmasking on label(lab_name);

modiry

select * from t_test;
```

```sql
-- 1. create resource label for column of specified table
-- maybe should declacre schema like schemaname.tablename.colname
-- 
create resource label lab_name add column(tablename.colname);
-- 2. create masking policy policyname
create masking policy policy_name maskall randommasking creditcardmasking 
basicemailmasking
fullmailmasking
-- 3.create masking policy mask1 maskall on label(labelname)
select * from gs_masking -- 查看脱敏策略
select * from t_test
insert into values(4,'425-645-89413'),(5,'123-345-45678');
-- 一般作用于字符串类型
alter masking policy mask1 add creditcardmasking on label(lab_name);
-- 如果modify之前对同一表作了过多的masking policy的创建，应该先删除，
-- 再modify
alter masking policy mask1 modify regexmasking('[0-9]','-',7,9) on label(lab_name)

-- alter --- add remove /modify(替换)
-- select * from t_test;

alter masking policy mask1 modify (filter on roles()，ip('/24')); -- 替换
alter masking policy mask1 drop filter; -- 移除

alter masking policy mask1 comments ""
alter masking policy mask1 disable

\h alter audit
insert into t_test values(102541,'102541');

create resource label lab_id add column(t_test.id);

create masking policy  mask2 creditcardmasking on label(lab_id);

crop masking policy mask1;

create masking policy mask2 creditcardmasking on label(lab_id);

select * from gs_masking;

select * from t_test;

```

##### 3.4 账本数据库

```sql
账本数据库-- 防篡改
with blockchain
\dn
```

#### 4. 存储过程

#### 5. 触发器

#### 6. 数据库性能优化

#### 7. 论述题目讲解

#### 8. 实验总结

```sql
-- 1. 实验手册也是要学习的哦
-- 2. 操作系统的安装
-- 3. openGauss的安装
-- 4. 抓紧时间学习哦！！！！！

-- 第一阶段
1. SQL 基础语法 20%-40%
2. SQL练习题目
3. 真题练习，总共8套

重点 SQL基础 触发器和游标 
    安全审计
 分析每类题目
1. 数据库对象管理及SQL应用 20-40
    1~8个小问，递进或者是依赖关系，至少2分
2. 数据库连接和用户及权限管理 10-20；
    1~9问递进或者是依赖关系
3. 安全审计和行级访问控制 10-20分
4. 存储过程、触发器、游标
5. 性能调优 20分
    3~5问 性能优化
6. 论述题讲解，
	一般是2问，备份恢复或者是性能优化

机试要注意的内容

3.220版本
看文档是可以看的
打开SQL执行记录
不要覆盖，不要覆盖，不要覆盖
```



#### 9. SQL直播练习





